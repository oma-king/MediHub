<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update Consultation</title>
</head>
<body>
<h1>Update Consultation</h1>
<form id="updateConsultationForm">
    <label for="reason">Reason:</label>
    <input type="text" id="reason" name="reason" required><br>

    <label for="description">Description:</label>
    <input type="text" id="description" name="description" required><br>

    <label for="price">Price:</label>
    <input type="number" id="price" name="price" required><br>

    <button type="submit">Update</button>
</form>
<!-- Delete button -->
<button id="deleteConsultationBtn">Delete Consultation</button>
<!-- Include jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Script to fetch consultation data and fill the form -->
<script>
    $(document).ready(function() {
        $('#deleteConsultationBtn').click(function() {
            // Display confirmation dialog
            if (confirm("Are you sure you want to delete this Consultation?")) {
                let urlParams = new URLSearchParams(window.location.search);
                let patientId = urlParams.get("id");

                // Send AJAX request to delete user
                $.ajax({
                    url: '/deleteConsultation/' + patientId,
                    type: 'DELETE',
                    success: function(response) {
                        alert(response); // Display success message
                        window.location.href = '/consultations'; // Redirect to the homepage or any other appropriate page
                    },
                    error: function(xhr, status, error) {
                        alert("Error deleting consultation: " + error); // Display error message
                    }
                });
            }
        });
    });
    // Function to fetch consultation data and pre-fill the form
    function fetchAndFillConsultationData() {
        // Extract consultation ID from the URL
        let urlParams = new URLSearchParams(window.location.search);
        let consultationId = urlParams.get("id");
        // Fetch consultation data from the backend
        fetch('/getConsultationById/' + consultationId)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch consultation data');
                }
                return response.json();
            })
            .then(consultation => {
                // Fill form fields with consultation data
                document.getElementById("reason").value = consultation.reason;
                document.getElementById("description").value = consultation.description;
                document.getElementById("price").value = consultation.price;
            })
            .catch(error => {
                console.error(error);
                alert('Failed to fetch consultation data');
            });
    }

    // Call the fetchAndFillConsultationData function when the page loads
    window.onload = fetchAndFillConsultationData;

    // Script to handle form submission
    document.getElementById("updateConsultationForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent default form submission

        // Collect form data
        let formData = {
            reason: document.getElementById("reason").value,
            description: document.getElementById("description").value,
            price: parseFloat(document.getElementById("price").value) // Parse to float
        };

        // Extract consultation ID from the URL
        let urlParams = new URLSearchParams(window.location.search);
        let consultationId = urlParams.get("id");

        // Send data to backend via AJAX
        fetch('/updateConsultation/' + consultationId, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to update consultation');
                }
                return response.text();
            })
            .then(message => {
                alert(message); // Show success message
                // Optionally redirect or perform other actions after updating consultation
                window.location.href = '/consultations'; // Redirect to the consultations page or any other appropriate page
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to update consultation');
            });
    });
</script>
</body>
</html>
